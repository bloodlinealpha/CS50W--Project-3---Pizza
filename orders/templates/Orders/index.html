{% extends "Orders/layout.html" %}

{% block heading %}
	
{% endblock %}

{% block body %}

{% if user.is_authenticated %}
	<!--Logged in-->

	<div class="menu-flex">
		<h1 class="menu-title">Menu Items:</h1>
		<div class="pizza-flex">
			<!-- regular table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1 class="menu-title">{{ pizza_r_style.0.style }}</h1>
				</div>
				<div>
					<table id="regular_pizza" class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Topping</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
								<th scope="col">Order</th>
							</tr>

						</thead>
						<tbody>
						{% for small, large in pizza_list %}
							<tr class="pizza-rows" id="regular_table_{{ forloop.counter0 }}">
								<td class="topping">{{ small.topping }}</td>
								<td class="small">{{ small.price }}</td>		
								<td class="large">{{ large.price }}</td>
								<td ><a href="#" class="cart_b" id="cart_{{forloop.counter0}}"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cart-plus-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
							  <path fill-rule="evenodd" d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zM4 14a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm7 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z"/>
							</svg></a> </td>		
							</tr>
							{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
			<!-- sicilian table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1 class="menu-title">{{ pizza_r_style.1.style }}</h1>
				</div>

				<div>
					<table id="sicilian_pizza" class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Topping</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
								<th scope="col">Order</th>
							</tr>
						</thead>
						<tbody>
						{% for small, large in pizza_list2 %}
							<tr class="pizza-rows" id="sicilian_table_{{ forloop.counter0 }}">
								<td class="topping">{{ small.topping }}</td>
								<td class="small">{{ small.price }}</td>		
								<td class="large">{{ large.price }}</td>
								<td ><a href="#" class="cart_b" id="cart_{{forloop.counter0}}"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cart-plus-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
							  <path fill-rule="evenodd" d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zM4 14a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm7 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z"/>
							</svg></a> </td>	
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
			<!-- Topping table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1 class="menu-title">Toppings</h1>
				</div>

				<div class="topping-list">
					{% for topping in toppings %}
					<ul class="list-group">
						<li class="topping-name list-group-item">{{ topping.name }}</li>
					</ul>
					{% endfor %}
					
				</div>
			</div>
		</div>
		<!-- Sub table -->
		<div class="sub-flex">
			<!-- regular table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1 class="menu-title">Subs</h1>
				</div>
				<div>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Sub</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
								<th scope="col">Order</th>
							</tr>
						</thead>
						<tbody>
						{% for small, large in subs %}
							<tr class="sub-rows" id="sub_table_{{ forloop.counter0 }}">
								<td class="topping">{{ small.name }}</td>
								<td class="small">{{ small.price }}</td>		
								<td class="large">{{ large.price }}</td>
								<td ><a href="#" class="cart_b" id="cart_{{forloop.counter0}}"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cart-plus-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
							  <path fill-rule="evenodd" d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zM4 14a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm7 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z"/>	
							</tr>
						{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
			<!-- extras table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1 class="menu-title">Sub Extras</h1>
				</div>
				<div>
					<table id="sub_extras_table" class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Extra</th>
								<th scope="col">Price</th>
							</tr>
						</thead>
						<tbody>
						{% for extra in subextras %}
							<tr class="extras_each">
								<td class="extra_extra">{{ extra.extra }}</td>
								<td class="extra_price">{{ extra.price }}</td>		
								
							</tr>
						{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
		</div>


	</div>


	<!-- click Modal-->
	<button id="modal_2_click" type="button" class="btn btn-primary" data-toggle="modal" data-target="#click_item">
	  Add specifics
	</button>

	<!-- Modal -->
	<div class="modal fade" id="click_item" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	  <div class="modal-dialog modal_2 modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="staticBackdropLabel">Selections</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <div id="selection_div">
	        	<form id="cart_form" action="{% url 'cart' %}" method="post">
	        	{% csrf_token %}
	        		<div>
		        		<label for="cart_item" id="cart_item_label" style="font-weight:bold"></label>
		        		<input class="hide-input" id="cart_item" type="text" name="item" disabled hidden></input>
	        		</div>
	        		<div>
		        		<label for="cart_topping" id="cart_topping_label" style="font-weight:bold" ></label>
		        		<input class="hide-input" id="cart_topping" type="text" name="topping" disabled hidden></input>
	        		</div>
	        		<div id="topping_1_div" class="topping_selector">
	        			<label for="topping_1" style="font-weight:bold">Select Topping #1: </label>
	        			<select class="topping-class" id="topping_1" name="topping-1">
	        				<option value="" selected>Select your Option</option>
	        				{% for topping in toppings %}
	        				<option value="{{topping.name}}">{{topping.name}}</option>
	        				{% endfor %}
	        			</select>
	        		</div>
	        		<div id="topping_2_div" class="topping_selector">
	        			<label for="topping_2" style="font-weight:bold">Select Topping #2: </label>
	        			<select class="topping-class" id="topping_2" name="topping-2">
	        				<option value="" selected>Select your Option</option>
	        				{% for topping in toppings %}
	        				<option value="{{topping.name}}">{{topping.name}}</option>
	        				{% endfor %}
	        			</select>
	        		</div>
	        		<div id="topping_3_div" class="topping_selector">
	        			<label for="topping_3" style="font-weight:bold">Select Topping #3: </label>
	        			<select class="topping-class" id="topping_3" name="topping-3">
	        				<option value="" selected>Select your Option</option>
	        				{% for topping in toppings %}
	        				<option value="{{topping.name}}">{{topping.name}}</option>
	        				{% endfor %}
	        			</select>
	        		</div>
	        		<div>
		        		<label id="cart_size_label" style="font-weight:bold">Size: </label>
		        		<select id="cart_size" name="size">
		        			<option value="small">Small</option>
		        			<option value="large">Large</option>
		        		</select>
	        		</div>
	        		<div id="extras_div" class="extras_selector">
	        			
	        		</div>
	        		<div style="border-top: 1px solid grey">
		        		<label id="cart_price_label" style="font-weight:bold">Price: </label>
		        		<input class="hide-input" id="cart_price" type="number" name="price" min="0" step="0.01" disabled></input>
	        		</div>
	        		<input type="submit" id="pizza_submit" name="pizza-form"></input>
	        		<input type="submit" id="sub_submit" name="sub-form"></input>
	        	</form>
	        	
	        </div>
	      </div>
	      <div class="modal-footer">
	        <button id="selections_close" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
	        <button id="selections_submit" type="button" class="btn btn-primary">Add to Cart</button>
	      </div>
	    </div>
	  </div>
	</div>


{% else %}

	<!--Not logged in -->
	<div class="menu-flex">
		<h1 class="menu-title">Menu Items:</h1>
		<div class="pizza-flex">
			<!-- regular table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1>{{ pizza_r_style.0.style }}</h1>
				</div>
				<div>
					<table id="pizza_table" class="table table-bordered">
						<thead>
							<tr id="pizza_h">
								<th scope="col">Topping</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
							</tr>
						</thead>
						<tbody>
						{% for small, large in pizza_list %}
							<tr id="pizza_r">
								<td>{{ small.topping }} </td>
								<td>{{ small.price }} </td>		
								<td>{{ large.price }} </td>	
							</tr>
							{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
			<!-- sicilian table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1>{{ pizza_r_style.1.style }}</h1>
				</div>

				<div>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Topping</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
							</tr>
						</thead>
						<tbody>
						{% for small, large in pizza_list2 %}
							<tr>
								<td>{{ small.topping }} </td>
								<td>{{ small.price }} </td>		
								<td>{{ large.price }} </td>	
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
			<!-- Topping table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1>Toppings</h1>
				</div>

				<div class="topping-list">
					{% for topping in toppings %}
					<ul class="list-group">
						<li class="list-group-item">{{ topping.name }}</li>
					</ul>
					{% endfor %}
					
				</div>
			</div>
		</div>
		<!-- Sub table -->
		<div class="sub-flex">
			<!-- regular table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1>Subs</h1>
				</div>
				<div>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Sub</th>
								<th scope="col">Small</th>
								<th scope="col">Large</th>
							</tr>
						</thead>
						<tbody>
						{% for small, large in subs %}
							<tr>
								<td>{{ small.name }} </td>
								<td>{{ small.price }} </td>		
								<td>{{ large.price }} </td>	
							</tr>
						{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
			<!-- extras table -->
			<div class="menu-table">
				<div class="menu-style">
					<h1>Sub Extras</h1>
				</div>
				<div>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th scope="col">Extra</th>
								<th scope="col">Price</th>
							</tr>
						</thead>
						<tbody>
						{% for extra in subextras %}
							<tr>
								<td>{{ extra.extra }} </td>
								<td>{{ extra.price }} </td>		
								
							</tr>
						{% endfor %}
						</tbody>

					</table>
				</div>
			</div>
		</div>


	</div>
		
{% endif %}



	
	
		

	

{% endblock %}

{% block scripts %}

<script>
//Jquery
	$(document).ready(function(){
		$('#modal_2_click').hide();
		

		

		$(document).on('click', '.cart_b', function(e){
			e.preventDefault();
			$('#modal_2_click').click();
			$('.topping_selector, .extras_selector').hide();

			
			
			

			var cart_row = $(this).closest('tr').attr('id');
			var table_name = $(this).closest('.menu-table').find('h1.menu-title').html();

			//create row object
			$('#'+cart_row).each(function(){
				var topping = ($(this).children('.topping').html());
				var small_price = ($(this).children('.small').html());
				var large_price = ($(this).children('.large').html());

				row_data = {'topping':topping, 'small':small_price, 'large':large_price};
			});



			//create extras row object
			$('.extras_each').each(function(){
				var extra = ($(this).children('.extra_extra').html());
				var price = ($(this).children('.extra_price').html());
		
				extras_data = {'extra':extra, 'price':price};
			});

			//find pizza rows
			var cart_type = $(this).closest('tr').attr('class');

			//add table name to input
			$('#cart_item').val(table_name);
			//add cart item to label
			if (table_name == 'Subs') {
				$('#cart_item_label').html('Sub');
			}else{
				$('#cart_item_label').html(table_name);
			}
			

			//add topping data to input
			$('#cart_topping').val(row_data.topping);

			$('#pizza_submit').hide();
			$('#sub_submit').hide();
			

			//if for item added to cart is a pizza
			if (cart_type == "pizza-rows") {

				
				//$('#pizza_submit').show();
				$('#selections_submit').on('click', function(e){
					e.preventDefault()
					$('.topping-class:visible').each(function(){
						if ($(this).val() == "") {
							$(this).css('color', 'red');
						}else{
							$(this).css('color', 'black');

						}
					});

					if ($('.topping-class:visible').val() != "") {
						$('#pizza_submit').click()
					}else{
						
						console.log("still one empty")	
					}
					
					
					
					
				})
				


				//if for price based on size
				if ($('#cart_size').val() == 'small') {
					$('#cart_price').val(row_data.small);
				}
				if ($('#cart_size').val() == 'large') {
					$('#cart_price').val(row_data.large);
				}

				//if size is changed
				$(document).on('change', '#cart_size', function(){
					
					if ($('#cart_size ').val() == 'small') {
						$('#cart_price').val(row_data.small);
					}
					if ($('#cart_size').val() == 'large'){
						$('#cart_price').val(row_data.large);
					}
				});

				//add topping to label
				$('#cart_topping_label').html(''+ row_data.topping +' Topping');

				//if for topping selects
				if (row_data.topping == 1) {
					$('#topping_1_div').show();
				}
				if (row_data.topping == 2) {
					$('#topping_1_div').show();
					$('#topping_2_div').show();
				}
				if (row_data.topping == 3) {
					$('.topping_selector').show();
				}
			// for subs
			}else
			{
				
				//$('#sub_submit').show();
				$('#selections_submit').on('click', function(e){
					e.preventDefault()
					$('#sub_submit').click();
				})
				//clear cart price for subs
				$('#cart_price').val("");

				//if for price based on size
				if ($('#cart_size').val() == 'small') {
					$('#cart_price').val(row_data.small);
				}
				if ($('#cart_size').val() == 'large') {
					$('#cart_price').val(row_data.large);
				}

				//add topping to label
				$('#cart_topping_label').html(row_data.topping);
				//add extras options
				$('.extras_selector').show();
				$('#extras_div').empty();
				

				$('.extras_each').each(function(index){
					$('#extras_div').append('\
						<div>\
							<label for="extra_'+index+'" style="font-weight:bold">Select Extras #'+eval(index+1)+'</label>\
		        			<select id="extra_'+index+'" class="extra_change" name="extra-'+eval(index+1)+'">\
		        				<option data-extra ="0" value="none" selected>None</option>\
		        				{% for extra in subextras %}\
		        				<option data-extra ="{{extra.price}}" value="{{extra.extra}}">{{extra.extra}} +{{extra.price}}</option>\
		        				{% endfor %}\
		        			</select>\
	        			</div>\
						');
				});
			
				//add to price when extra is added
				$(document).on('change', '.extra_change, #cart_size', function(){
					var extra_total= 0;
						$('.extra_change').each(function(){
							var data_app = $(this).find(':selected').data('extra');
							extra_total += parseFloat(data_app);
						});
						
					if ($('#cart_size ').val() == 'small') {
						
						$('#cart_price').val((parseFloat(row_data.small)+parseFloat(extra_total)).toFixed(2));
					}
					if ($('#cart_size').val() == 'large'){
						
						$('#cart_price').val((parseFloat(row_data.large)+parseFloat(extra_total)).toFixed(2));
					}

				});	
			}

			$('#cart_form').on('submit', function(e){
				
				$('input:disabled').removeAttr('disabled');
			});
		});
		
		



	});
	
</script>

{% endblock %}